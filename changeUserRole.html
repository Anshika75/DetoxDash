<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <table>
      <tr>
        <th>Name</th>
        <th>Profile Pic</th>
        <th>Email</th>
        <th>Role</th>
        <th>Change Role</th>
        <th>Delete User</th>
      </tr>
      <tr></tr>
    </table>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="./auth.js"></script>
    <script>
      const table = document.querySelector("table");
      db.collection("users")
        .get()
        .then(function (querySnapshot) {
          querySnapshot.forEach(function (doc) {
            if (doc.id == auth.currentUser.uid || doc.data().type == "admin") {
              return;
            }
            table.innerHTML += `
                    <tr>
                        <td>${doc.data().name}</td>
                        <td><img src="${doc.data().profilePic}" alt=""></td>
                        <td>${doc.data().email}</td>
                        <td>${doc.data().type}</td>
                        <td>
                            <select onchange="changeRole('${doc.id}')">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>

                            </select>
                            </td>
                        <td><button onclick="deleteUser('${
                          doc.id
                        }')">Delete User</button></td>
                    </tr>
                `;
          });
        });
      function changeRole(id) {
        db.collection("users")
          .doc(id)
          .update({
            type: newRole,
          })
          .then(function () {
            alert("Role changed");
          });
      }
      function deleteUser(id) {
        db.collection("users")
          .doc(id)
          .delete()
          .then(function () {
            alert("User deleted");
          });
      }
    </script>
  </body>
</html>
